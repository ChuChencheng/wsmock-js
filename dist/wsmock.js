!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WsMock=t():e.WsMock=t()}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.mockSocketUrls=[],t.mockSocketSettings=[]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners={}}return o(e,[{key:"addEventListener",value:function(e,t){e in this.listeners||(this.listeners[e]=[]);var n=this.listeners[e];return n.push(t),n.length-1}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var n=this.listeners[e],o=0,r=n.length;o<r;o++)if(n[o]===t)return void n.splice(o,1)}},{key:"dispatchEvent",value:function(e){if(!(e.type in this.listeners))return!0;for(var t=this.listeners[e.type],n=0,o=t.length;n<o;n++)t[n].call(this,e);return!e.defaultPrevented}},{key:"modifyHandler",value:function(e,t,n){e in this.listeners&&"number"!=typeof t&&(this.listeners[e][t]=n)}},{key:"removeAllListeners",value:function(){this.listeners={}}}]),e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=n(1);var s=new((o=r)&&o.__esModule?o:{default:o}).default;t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=u(n(2)),s=n(0),i=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}if(!window.WebSocket)throw new Error("Your browser does not support WebSocket.");var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,null,[{key:"config",value:function(t){Object.assign(e.settings,t)}},{key:"mock",value:function(e){e.url?(function(e){var t=-1;s.mockSocketUrls.some(function(n,o){return n===e.url&&(t=o,!0)})?s.mockSocketSettings[t].push(e):(s.mockSocketUrls.push(e.url),s.mockSocketSettings.push([e]))}(e),function(e){var t=function(){e.sender.call(e),e.response?r.default.dispatchEvent({type:"_message",url:e.url,messageEventDict:{data:e.response}}):console.warn("Please specify response data for url '"+e.url+"'.")};if("number"==typeof e.sendInterval)e._intervalId=setInterval(t,e.sendInterval);else if(Array.isArray(e.sendInterval)){var n=0;e.sendInterval=e.sendInterval.filter(function(e){return"number"==typeof e});var o=e.sendInterval.length;o&&(e._timeoutId=setTimeout(function r(){t(),++n===o&&(n=0),e._timeoutId=setTimeout(r,e.sendInterval[n])},e.sendInterval[n]))}else e.sendInterval}(e)):console.error("Url must be specified.")}}]),e}();a.settings={CONNECTING_TIME:100,CLOSING_TIME:100,SEND_RATE:1048576},window.WebSocket=i.default,t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=a(n(1)),s=a(n(2)),i=a(n(3)),u=n(0);function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=window.WebSocket,f=function(e){function t(e,n){var o;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),arguments.length<1)throw TypeError("Failed to construct 'WebSocket': 1 argument required, but only 0 present.");for(var r=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),s=0;s<u.mockSocketUrls.length;s++)if(u.mockSocketUrls[s]===e)return r._defineFields(),r._observeProps(),r._url=e,r._protocol=n,r._index=s,r._attachEvents(),setTimeout(function(){r._readyState=t.OPEN},i.default.settings.CONNECTING_TIME),l(r);return console.log("%cMock setting for url '"+e+"' not found, native WebSocket will be invoked.","color: blue;"),o=new c(e,n),l(r,o)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default),o(t,[{key:"send",value:function(e){var n=this;if(arguments.length<1)throw new TypeError("Failed to execute 'send' on 'WebSocket': 1 argument required, but only 0 present.");if(this._readyState===t.CONNECTING)throw new DOMException("Failed to execute 'send' on 'WebSocket': Still in CONNECTING state.","InvalidStateError");if(this._readyState===t.OPEN){var o=0,r=e;"string"==typeof e||e instanceof String?o+=e.length:e instanceof ArrayBuffer?o+=e.byteLength:e instanceof Blob?o+=e.size:e.byteLength?o+=e.byteLength*(e.BYTES_PER_ELEMENT||1):o+=(r=""+e).length,this._bufferedAmount+=o;var s=u.mockSocketSettings[this._index],a=this.bufferedAmount/i.default.settings.SEND_RATE*1e3;setTimeout(function(){s.map(function(e){var t=e.receiver;t&&t.call(e,r),n._bufferedAmount=0})},a)}else console.error("WebSocket is already in CLOSING or CLOSED state.")}},{key:"close",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,o=arguments[1];if(n=Number(n),1e3!==(n=isNaN(n)||n<0?0:n>65535?65535:n)&&(n<3e3||n>4999))throw new DOMException("Failed to execute 'close' on 'WebSocket': The code must be either 1000, or between 3000 and 4999. "+n+" is neither.","InvalidAccessError");this._readyState=t.CLOSING,setTimeout(function(){e._closeEventDict.code=n,o&&(e._closeEventDict.reason=o),e.removeAllListeners(),e._readyState=t.CLOSED},i.default.settings.CLOSING_TIME)}},{key:"_defineFields",value:function(){this.binaryType="blob",this.bufferedAmount=0,this.extensions="",this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.protocol="",this.readyState=t.CONNECTING,this.url=null,this._bufferedAmount=0,this._extensions="",this._protocol="",this._readyState=t.CONNECTING,this._url=null,this._index=-1,this._closeEventDict={code:1e3,reason:"Connection of mock WebSocket with url '"+this.url+"' is closed because you are so ugly.",wasClean:!0}}},{key:"_attachEvents",value:function(){s.default.addEventListener("_message",this._dispatchMessageEvent.bind(this))}},{key:"_dispatchMessageEvent",value:function(e){e.url===this.url&&this.dispatchEvent(new MessageEvent("message",Object.assign({data:null,origin:"",lastEventId:"",source:null,ports:[]},e.messageEventDict)))}},{key:"_observeProps",value:function(){this._observeBinaryType(),this._observeBufferedAmount(),this._observeExtensions(),this._observeProtocol(),this._observeOnEvents(),this._observeReadyState(),this._observeUrl()}},{key:"_observeBinaryType",value:function(){var e=["blob","arraybuffer"],t="blob";Object.defineProperty(this,"binaryType",{configurable:!0,enumerable:!0,get:function(){return t},set:function(n){e.indexOf(n)>-1?t=n:console.warn("The provided value '"+n+"' is not a valid enum value of type BinaryType.")}})}},{key:"_observeBufferedAmount",value:function(){this._observeReadOnlyProps("bufferedAmount",0)}},{key:"_observeExtensions",value:function(){this._observeReadOnlyProps("extensions","")}},{key:"_observeProtocol",value:function(){this._observeReadOnlyProps("protocol","")}},{key:"_observeOnEvents",value:function(){var e=this;["close","error","message","open"].map(function(t){Object.defineProperty(e,"on"+t,{configurable:!0,enumerable:!0,get:function(){return null},set:function(e){this.addEventListener(t,e)}})})}},{key:"_observeReadyState",value:function(){var e=this;this._observeReadOnlyProps("readyState",t.CONNECTING,function(n){switch(n){case t.OPEN:e.dispatchEvent(new CustomEvent("open"));break;case t.CLOSED:e.dispatchEvent(new CloseEvent("close",{code:e._closeEventDict.code,reason:e._closeEventDict.reason,wasClean:e._closeEventDict.wasClean}))}})}},{key:"_observeUrl",value:function(){this._observeReadOnlyProps("url",null)}},{key:"_observeReadOnlyProps",value:function(e,t,n){var o=t;Object.defineProperty(this,"_"+e,{configurable:!0,enumerable:!1,get:function(){return o},set:function(t){o=t,n&&"function"==typeof n&&n.call(this,t),Object.defineProperty(this,e,{value:o,configurable:!0,enumerable:!0,writable:!1})}}),this["_"+e]=t}}]),t}();f.CONNECTING=0,f.prototype.CONNECTING=f.CONNECTING,f.OPEN=1,f.prototype.OPEN=f.OPEN,f.CLOSING=2,f.prototype.CLOSING=f.CLOSING,f.CLOSED=3,f.prototype.CLOSED=f.CLOSED,t.default=f}]).default});
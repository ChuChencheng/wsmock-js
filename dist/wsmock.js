!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WsMock=t():e.WsMock=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.mockSocketUrls=[],t.mockSocketSettings=[]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners={}}return r(e,[{key:"addEventListener",value:function(e,t){e in this.listeners||(this.listeners[e]=[]);var n=this.listeners[e];return n.push(t),n.length-1}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var n=this.listeners[e],r=0,o=n.length;r<o;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"dispatchEvent",value:function(e){if(!(e.type in this.listeners))return!0;for(var t=this.listeners[e.type],n=0,r=t.length;n<r;n++)t[n].call(this,e);return!e.defaultPrevented}},{key:"modifyHandler",value:function(e,t,n){e in this.listeners&&"number"!=typeof t&&(this.listeners[e][t]=n)}},{key:"removeAllListeners",value:function(){this.listeners={}}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(1);var i=new((r=o)&&r.__esModule?r:{default:r}).default;t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=u(n(2)),i=n(0),s=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}if(!window.WebSocket)throw new Error("Your browser does not support WebSocket.");var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"config",value:function(t){Object.assign(e.settings,t)}},{key:"mock",value:function(e){e.url?(function(e){var t=-1;i.mockSocketUrls.some(function(n,r){return n===e.url&&(t=r,!0)})?i.mockSocketSettings[t].push(e):(i.mockSocketUrls.push(e.url),i.mockSocketSettings.push([e]))}(e),function(e){var t=function(){e.sender.call(e),e.response?o.default.dispatchEvent({type:"_message",url:e.url,messageEventDict:{data:e.response}}):console.warn("Please specify response data for url '"+e.url+"'.")};if("number"==typeof e.sendInterval)e._intervalId=setInterval(t,e.sendInterval);else if(Array.isArray(e.sendInterval)){var n=0;e.sendInterval=e.sendInterval.filter(function(e){return"number"==typeof e});var r=e.sendInterval.length;r&&(e._timeoutId=setTimeout(function o(){t(),++n===r&&(n=0),e._timeoutId=setTimeout(o,e.sendInterval[n])},e.sendInterval[n]))}else"onreceive"===e.sendInterval&&o.default.addEventListener("_receive",function(n){!n.url===e.url&&t()})}(e)):console.error("Url must be specified.")}}]),e}();a.settings={CONNECTING_TIME:100,CLOSING_TIME:100,SEND_RATE:1048576},window.WebSocket=s.default,t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=a(n(1)),i=a(n(2)),s=a(n(3)),u=n(0);function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=window.WebSocket,f=function(e){function t(e,n){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),arguments.length<1)throw TypeError("Failed to construct 'WebSocket': 1 argument required, but only 0 present.");for(var o=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=0;i<u.mockSocketUrls.length;i++)if(u.mockSocketUrls[i]===e)return o._defineFields(),o._observeProps(),o._url=e,o._protocol=n,o._closeEventDict={code:1e3,reason:"Connection of mock WebSocket with url '"+o.url+"' is closed because you are so ugly.",wasClean:!0},o._index=i,o._attachEvents(),setTimeout(function(){o._readyState=t.OPEN},s.default.settings.CONNECTING_TIME),l(o);return console.log("%cMock setting for url '"+e+"' not found, native WebSocket will be invoked.","color: blue;"),r=new c(e,n),l(o,r)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"send",value:function(e){var n=this;if(arguments.length<1)throw new TypeError("Failed to execute 'send' on 'WebSocket': 1 argument required, but only 0 present.");if(this._readyState===t.CONNECTING)throw new DOMException("Failed to execute 'send' on 'WebSocket': Still in CONNECTING state.","InvalidStateError");if(this._readyState===t.OPEN){var r=0,o=e;"string"==typeof e||e instanceof String?r+=e.length:e instanceof ArrayBuffer?r+=e.byteLength:e instanceof Blob?r+=e.size:e.byteLength?r+=e.byteLength*(e.BYTES_PER_ELEMENT||1):r+=(o=""+e).length,this._bufferedAmount+=r;var a=u.mockSocketSettings[this._index],l=this.bufferedAmount/s.default.settings.SEND_RATE*1e3;setTimeout(function(){a.map(function(e){var t=e.receiver;t&&t.call(e,o),i.default.dispatchEvent({type:"_receive",url:e.url}),n._bufferedAmount=0})},l)}else console.error("WebSocket is already in CLOSING or CLOSED state.")}},{key:"close",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,r=arguments[1];if(n=Number(n),1e3!==(n=isNaN(n)||n<0?0:n>65535?65535:n)&&(n<3e3||n>4999))throw new DOMException("Failed to execute 'close' on 'WebSocket': The code must be either 1000, or between 3000 and 4999. "+n+" is neither.","InvalidAccessError");this._readyState=t.CLOSING,setTimeout(function(){e._closeEventDict.code=n,r&&(e._closeEventDict.reason=r),e._readyState=t.CLOSED,e.removeAllListeners()},s.default.settings.CLOSING_TIME)}},{key:"_defineFields",value:function(){this.binaryType="blob",this.bufferedAmount=0,this.extensions="",this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.protocol="",this.readyState=t.CONNECTING,this.url=null,this._bufferedAmount=0,this._extensions="",this._protocol="",this._readyState=t.CONNECTING,this._url=null,this._index=-1}},{key:"_attachEvents",value:function(){i.default.addEventListener("_message",this._dispatchMessageEvent.bind(this))}},{key:"_dispatchMessageEvent",value:function(e){e.url===this.url&&this.dispatchEvent(this._defineEventProps(new MessageEvent("message",Object.assign({data:null,origin:this.url,lastEventId:"",source:null,ports:[]},e.messageEventDict))))}},{key:"_observeProps",value:function(){this._observeBinaryType(),this._observeBufferedAmount(),this._observeExtensions(),this._observeProtocol(),this._observeOnEvents(),this._observeReadyState(),this._observeUrl()}},{key:"_observeBinaryType",value:function(){var e=["blob","arraybuffer"],t="blob";Object.defineProperty(this,"binaryType",{configurable:!0,enumerable:!0,get:function(){return t},set:function(n){e.indexOf(n)>-1?t=n:console.warn("The provided value '"+n+"' is not a valid enum value of type BinaryType.")}})}},{key:"_observeBufferedAmount",value:function(){this._observeReadOnlyProps("bufferedAmount",0)}},{key:"_observeExtensions",value:function(){this._observeReadOnlyProps("extensions","")}},{key:"_observeProtocol",value:function(){this._observeReadOnlyProps("protocol","")}},{key:"_observeOnEvents",value:function(){var e=this;["close","error","message","open"].map(function(t){Object.defineProperty(e,"on"+t,{configurable:!0,enumerable:!0,get:function(){return null},set:function(e){this.addEventListener(t,e)}})})}},{key:"_observeReadyState",value:function(){var e=this;this._observeReadOnlyProps("readyState",t.CONNECTING,function(n){switch(n){case t.OPEN:e.dispatchEvent(e._defineEventProps(new Event("open")));break;case t.CLOSED:e.dispatchEvent(e._defineEventProps(new CloseEvent("close",{code:e._closeEventDict.code,reason:e._closeEventDict.reason,wasClean:e._closeEventDict.wasClean})))}})}},{key:"_observeUrl",value:function(){this._observeReadOnlyProps("url",null)}},{key:"_observeReadOnlyProps",value:function(e,t,n){var r=t;Object.defineProperty(this,"_"+e,{configurable:!0,enumerable:!1,get:function(){return r},set:function(t){r=t,n&&"function"==typeof n&&n.call(this,t),Object.defineProperty(this,e,{value:r,configurable:!0,enumerable:!0,writable:!1})}}),this["_"+e]=t}},{key:"_defineEventProps",value:function(e){var t=this;return["srcElement","currentTarget","target"].map(function(n){Object.defineProperty(e,n,{value:t,configurable:!0,enumerable:!0})}),e}}]),t}();f.CONNECTING=0,f.prototype.CONNECTING=f.CONNECTING,f.OPEN=1,f.prototype.OPEN=f.OPEN,f.CLOSING=2,f.prototype.CLOSING=f.CLOSING,f.CLOSED=3,f.prototype.CLOSED=f.CLOSED,t.default=f}]).default});
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WsMock=t():e.WsMock=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.mockSocketUrls=[],t.mockSocketSettings=[]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners={}}return r(e,[{key:"addEventListener",value:function(e,t){e in this.listeners||(this.listeners[e]=[]);var n=this.listeners[e];return n.push(t),n.length-1}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var n=this.listeners[e],r=0,o=n.length;r<o;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"dispatchEvent",value:function(e){if(!(e.type in this.listeners))return!0;for(var t=this.listeners[e.type],n=0,r=t.length;n<r;n++)t[n].call(this,e);return!e.defaultPrevented}},{key:"modifyHandler",value:function(e,t,n){e in this.listeners&&"number"==typeof t&&(this.listeners[e][t]=n)}},{key:"removeAllListeners",value:function(){this.listeners={}}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(1);var i=new((r=o)&&r.__esModule?r:{default:r}).default;t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.procSentData=function(e){var t=0,n=e;return"string"==typeof e?t+=e.length:e instanceof ArrayBuffer?t+=e.byteLength:e instanceof Blob?t+=e.size:e.byteLength?t+=e.byteLength*(e.BYTES_PER_ELEMENT||1):t+=(n=""+e).length,{dataToBeSent:n,dataSize:t}},t.isValidUrl=function(e){var t={};try{t=new URL(e)}catch(t){return"The URL '"+e+"' is invalid."}var n=t.protocol;return"ws:"===n||"wss:"===n||"The URL's scheme must be either 'ws' or 'wss'. '"+n.slice(0,-1)+"' is not allowed."}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(3),i=a(n(2)),s=n(0),u=a(n(5));function a(e){return e&&e.__esModule?e:{default:e}}if(!window.WebSocket)throw new Error("Your browser does not support WebSocket.");var l=0,c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"config",value:function(t){Object.assign(e.settings,t)}},{key:"mock",value:function(e){e.url?(e._id=l++,function(e){var t=-1;s.mockSocketUrls.some(function(n,r){return n===e.url&&(t=r,!0)})?s.mockSocketSettings[t].push(e):(s.mockSocketUrls.push(e.url),s.mockSocketSettings.push([e]))}(e),function(e){var t=function(){if(e.sender.call(e),e.response){var t=(0,o.procSentData)(e.response);i.default.dispatchEvent({type:"_message",url:e.url,messageEventDict:{data:t.dataToBeSent}})}else console.warn("Please specify response data for url '"+e.url+"'.")};if("number"==typeof e.sendInterval)e._intervalId=setInterval(t,e.sendInterval);else if(Array.isArray(e.sendInterval)){var n=0;e.sendInterval=e.sendInterval.filter(function(e){return"number"==typeof e});var r=e.sendInterval.length;r&&(e._timeoutId=setTimeout(function o(){t(),++n===r&&(n=0),e._timeoutId=setTimeout(o,e.sendInterval[n])},e.sendInterval[n]))}else"onreceive"===e.sendInterval&&i.default.addEventListener("_receive",function(n){n.url===e.url&&n._id===e._id&&t()})}(e)):console.error("Url must be specified.")}}]),e}();c.settings={CONNECTING_TIME:100,CLOSING_TIME:100,SEND_RATE:1048576},window.WebSocket=u.default,t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(3),i=l(n(1)),s=l(n(2)),u=l(n(4)),a=n(0);function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f=window.WebSocket,d=function(e){function t(e,n){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),arguments.length<1)throw TypeError("Failed to construct 'WebSocket': 1 argument required, but only 0 present.");for(var i=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),s=0;s<a.mockSocketUrls.length;s++)if(a.mockSocketUrls[s]===e){var l=(0,o.isValidUrl)(e);if("string"==typeof l)throw new DOMException("Failed to construct 'WebSocket': "+l);return i._defineFields(),i._observeProps(),i._url=e,i._protocol=n,i._closeEventDict={code:1e3,reason:"Connection of mock WebSocket with url '"+i.url+"' is closed because you are so ugly.",wasClean:!0},i._index=s,i._attachEvents(),setTimeout(function(){i._readyState=t.OPEN},u.default.settings.CONNECTING_TIME),c(i)}return console.log("%cMock setting for url '"+e+"' not found, native WebSocket will be invoked.","color: blue;"),r=new f(e,n),c(i,r)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),r(t,[{key:"send",value:function(e){var n=this;if(arguments.length<1)throw new TypeError("Failed to execute 'send' on 'WebSocket': 1 argument required, but only 0 present.");if(this._readyState===t.CONNECTING)throw new DOMException("Failed to execute 'send' on 'WebSocket': Still in CONNECTING state.","InvalidStateError");if(this._readyState===t.OPEN){var r=(0,o.procSentData)(e),i=r.dataSize,l=r.dataToBeSent;this._bufferedAmount+=i;var c=a.mockSocketSettings[this._index],f=this.bufferedAmount/u.default.settings.SEND_RATE*1e3;setTimeout(function(){c.map(function(e){var t=e.receiver;t&&t.call(e,l),s.default.dispatchEvent({type:"_receive",url:e.url,_id:e._id}),n._bufferedAmount=0})},f)}else console.error("WebSocket is already in CLOSING or CLOSED state.")}},{key:"close",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,r=arguments[1];if(n=Number(n),1e3!==(n=isNaN(n)||n<0?0:n>65535?65535:n)&&(n<3e3||n>4999))throw new DOMException("Failed to execute 'close' on 'WebSocket': The code must be either 1000, or between 3000 and 4999. "+n+" is neither.","InvalidAccessError");this._readyState=t.CLOSING,setTimeout(function(){e._closeEventDict.code=n,r&&(e._closeEventDict.reason=r),e._readyState=t.CLOSED,e.removeAllListeners()},u.default.settings.CLOSING_TIME)}},{key:"_defineFields",value:function(){this.binaryType="blob",this.bufferedAmount=0,this.extensions="",this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.protocol="",this.readyState=t.CONNECTING,this.url=null,this._bufferedAmount=0,this._extensions="",this._protocol="",this._readyState=t.CONNECTING,this._url=null,this._index=-1}},{key:"_attachEvents",value:function(){s.default.addEventListener("_message",this._dispatchMessageEvent.bind(this))}},{key:"_dispatchMessageEvent",value:function(e){e.url===this.url&&this.dispatchEvent(this._defineEventProps(new MessageEvent("message",Object.assign({data:null,origin:this.url,lastEventId:"",source:null,ports:[]},e.messageEventDict))))}},{key:"_observeProps",value:function(){this._observeBinaryType(),this._observeBufferedAmount(),this._observeExtensions(),this._observeProtocol(),this._observeOnEvents(),this._observeReadyState(),this._observeUrl()}},{key:"_observeBinaryType",value:function(){var e=["blob","arraybuffer"],t="blob";Object.defineProperty(this,"binaryType",{configurable:!0,enumerable:!0,get:function(){return t},set:function(n){e.indexOf(n)>-1?t=n:console.warn("The provided value '"+n+"' is not a valid enum value of type BinaryType.")}})}},{key:"_observeBufferedAmount",value:function(){this._observeReadOnlyProps("bufferedAmount",0)}},{key:"_observeExtensions",value:function(){this._observeReadOnlyProps("extensions","")}},{key:"_observeProtocol",value:function(){this._observeReadOnlyProps("protocol","")}},{key:"_observeOnEvents",value:function(){var e=this;["close","error","message","open"].map(function(t){var n=void 0,r=null;Object.defineProperty(e,"on"+t,{configurable:!0,enumerable:!0,get:function(){return r},set:function(e){r?this.modifyHandler(t,n,e):n=this.addEventListener(t,e),r=e}})})}},{key:"_observeReadyState",value:function(){var e=this;this._observeReadOnlyProps("readyState",t.CONNECTING,function(n){switch(n){case t.OPEN:e.dispatchEvent(e._defineEventProps(new Event("open")));break;case t.CLOSED:e.dispatchEvent(e._defineEventProps(new CloseEvent("close",{code:e._closeEventDict.code,reason:e._closeEventDict.reason,wasClean:e._closeEventDict.wasClean})))}})}},{key:"_observeUrl",value:function(){this._observeReadOnlyProps("url",null)}},{key:"_observeReadOnlyProps",value:function(e,t,n){var r=t;Object.defineProperty(this,"_"+e,{configurable:!0,enumerable:!1,get:function(){return r},set:function(t){r=t,n&&"function"==typeof n&&n.call(this,t),Object.defineProperty(this,e,{value:r,configurable:!0,enumerable:!0,writable:!1})}}),this["_"+e]=t}},{key:"_defineEventProps",value:function(e){var t=this;return["srcElement","currentTarget","target"].map(function(n){Object.defineProperty(e,n,{value:t,configurable:!0,enumerable:!0})}),e}}]),t}();d.CONNECTING=0,d.prototype.CONNECTING=d.CONNECTING,d.OPEN=1,d.prototype.OPEN=d.OPEN,d.CLOSING=2,d.prototype.CLOSING=d.CLOSING,d.CLOSED=3,d.prototype.CLOSED=d.CLOSED,d._nativeWebSocket=f,t.default=d}]).default});